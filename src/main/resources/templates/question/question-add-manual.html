<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>试题添加--手工</title>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}"  media="all">
    <th:block th:include="public::css"></th:block>
</head>
<body>
<div class="wrapper">
    <!-- 顶部导航、边栏 -->
    <th:block th:include="public :: header" ></th:block>
    <!--内容-->
    <div class="main-panel">
        <div class="content">
            <div class="page-inner">
                <div class="page-header">
                    <h4 class="page-title">试题录入</h4>
                    <ul class="breadcrumbs">
                        <li class="nav-home">
                            <a th:href="@{/}">
                                <i class="flaticon-home"></i>
                            </a>
                        </li>
                        <li class="separator">
                            <i class="flaticon-right-arrow"></i>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{/question/manage}">试题管理</a>
                        </li>
                        <li class="separator">
                            <i class="flaticon-right-arrow"></i>
                        </li>
                        <li class="nav-item">
                            <a th:href="@{/question/addChoice}">试题录入</a>
                        </li>
                        <li class="separator">
                            <i class="flaticon-right-arrow"></i>
                        </li>
                        <li class="nav-item">
                            <a href="#">手工录入</a>
                        </li>
                    </ul>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <h4 class="card-title">手工录入</h4>
                                    <div class="col-md-2 ml-auto">
                                        <a class="btn btn-success" th:href="@{/question/questionAddAuto}">自动录入</a>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="shadow-sm p-3 mb-5 bg-white rounded">
                                    <form class="form-inline" id="question_choice">
                                        <button type="button" class="layui-btn layui-btn-sm" data-toggle="modal" data-target="#catalogue">
                                            分类：
                                        </button>
                                        <input type="text"  value="" name="catalogue_title" id="tree-class">
                                        <input type="hidden" value="" name="question_class" id="tree-catalog-id">
                                        <label class="my-1 mr-2" for="inlineFormCustomSelect3">难度</label>
                                        <select class="custom-select my-1 mr-sm-2" name="question_level"  id="inlineFormCustomSelect3">
                                            <option selected value="">选择</option>
                                            <option value="简单" >简单</option>
                                            <option value="中等">中等</option>
                                            <option value="困难">困难</option>
                                        </select>
                                    </form>
                                </div>
                                <div th:include="tree :: tree-modal" ></div>
                                <nav>
                                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">选择题</a>
                                        <a class="nav-item nav-link" id="nav-MultiSelect-tab" data-toggle="tab" href="#nav-MultiSelect" role="tab" aria-controls="nav-MultiSelect" aria-selected="false">判断题</a>
                                        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">主观题</a>
                                    </div>
                                </nav>
                                <div class="tab-content" id="nav-tabContent">
                                    <!--选择题-->
                                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                                        <form id="question_form1">
                                        <div class="shadow-none p-3 mb-5 bg-light rounded">
                                            <div class="form-inline form-group">
                                            <label class="my-1 mr-2" for="SSelect"><div class="d-inline p-2 bg-primary text-white">选择题类型</div></label>
                                            <select class="custom-select my-1 mr-sm-2" id="SSelect" name="question_type" >
                                                <option value="单选题" selected>单选题</option>
                                                <option value="多选题">多选题</option>
                                            </select>
                                            </div>
                                            <div class="form-group">
                                                <h3><label for="question_title"><div class="d-inline p-2 bg-primary text-white">题目</div></label></h3>
                                                <input type="text" class="form-control" id="question_title" name="question_title" placeholder="请输入题干内容">
                                            </div>
                                            <div class="form-group">
                                                <h5 ><div class="d-inline p-2 bg-primary text-white">选项</div></h5>
                                            </div>

                                            <div id="form-answer">
                                            <div id="container" class="form-group">
                                                <div class="input-group">
                                                    <div class="input-group-text">
                                                            <input type="checkbox" id="answerCheck" value="" name="opt_status">
                                                    </div>
                                                    <input type="text" class="form-control"  name="opt_content" >
                                                    <div class="input-group-text">
                                                        <a class='button' onclick='test(this)' href="#"><i class="la flaticon-cross"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>

                                            <div class="form-group">
                                                <button type="button" id="add" class="btn btn-primary btn-lg btn-block">添加选项</button>
                                            </div>

                                            <div class="form-group">
                                                <h3><label for="question_analysis"><div class="d-inline p-2 bg-primary text-white">解析</div></label></h3>
                                                <textarea class="form-control" id="question_analysis" name="question_analysis" rows="3"></textarea>
                                            </div>
                                        </div>
                                        </form>
                                        <button type="button"  onclick="addQuestion(1)" class="btn btn-primary mb-2">保存</button>
                                        <button type="button"  onclick="test()" class="btn btn-primary mb-2">test</button>
                                    </div>

                                    <!--判断题-->
                                    <div class="tab-pane fade" id="nav-MultiSelect" role="tabpanel" aria-labelledby="nav-MultiSelect-tab">
                                        <form id="question_form2">
                                            <div class="shadow-none p-3 mb-5 bg-light rounded">
                                                <div class="form-group">
                                                    <h3><label for="question_title"><div class="d-inline p-2 bg-primary text-white">题目</div></label></h3>
                                                    <input type="text" name="question_title" class="form-control" id="question_title2" placeholder="请输入题干内容">
                                                </div>
                                                <div class="form-group">
                                                    <h4 class="form-text" ><div class="d-inline p-2 bg-primary text-white">答案</div></h4>
                                                    <div class="custom-control custom-radio">
                                                        <input type="radio" class="custom-control-input" id="radio-answer1" name="check_status" value="1">
                                                        <input type="hidden" name="opt_content" value="正确">
                                                        <label class="custom-control-label" for="radio-answer1">正确</label>
                                                    </div>
                                                    <div class="custom-control custom-radio mb-3">
                                                        <input type="radio" class="custom-control-input" id="radio-answer2" name="check_status" value="1">
                                                        <input type="hidden" name="opt_content" value="错误">
                                                        <label class="custom-control-label" for="radio-answer2">错误</label>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <h3><label for="Textarea1"><div class="d-inline p-2 bg-primary text-white">解析</div></label></h3>
                                                    <textarea name="question_analysis" class="form-control" id="Textarea1" rows="3"></textarea>
                                                </div>
                                            </div>
                                        </form>
                                        <button type="button"  onclick="addQuestion(2)" class="btn btn-primary mb-2">保存</button>
                                    </div>


                                    <!--主观题-->
                                    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                                        <form id="question_form3">
                                        <div class="shadow-none p-3 mb-5 bg-light rounded">
                                            <div class="form-group">
                                                <h3><label for="question_title"><div class="d-inline p-2 bg-primary text-white">题目</div></label></h3>
                                                <input type="text" name="question_title" class="form-control" id="question_title3" placeholder="请输入题干内容">
                                            </div>

                                            <div class="form-group" >
                                                <h3><label for="question_title"><div class="d-inline p-2 bg-primary text-white">参考答案</div></label></h3>
                                                <textarea class="form-control" name="opt_content"  id="answerTextarea" rows="3"></textarea>
                                            </div>

                                            <div class="form-group">
                                                <h3><label for="question_title"><div class="d-inline p-2 bg-primary text-white">解析</div></label></h3>
                                                <textarea name="question_analysis" class="form-control" id="exampleFormControlTextarea3" rows="3"></textarea>
                                            </div>

                                        </div>
                                            </form>
                                            <button type="button"  onclick="addQuestion(3)" class="btn btn-primary mb-2">保存</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div th:include="public :: footer" ></div>
    </div>


<!-- 主题 -->
<th:block th:include="public::setting"></th:block>
</div>
<th:block th:include="public::js"></th:block>
<script th:src="@{/layui/layui.js}" charset="utf-8"></script>
<th:block th:include="tree::tree-js"></th:block>
<script th:inline="javascript">
    //赋值给组件
    var add = document.getElementById('add');
    var container =document.getElementById('container');
    var node=container.nextSibling;
    var count = 1;
    add.onclick = function(){
        count++;
        oDiv = document.createElement('div');
        oDiv.innerHTML =" <div id=\"container\" class=\"form-group\">\n" +
            "                                                <div class=\"input-group\">\n" +
            "                                                    <div class=\"input-group-text\">\n" +
            "                                                            <input type=\"checkbox\" id=\"answerCheck\" value=\"\" name=\"opt_status\">\n" +
            "                                                    </div>\n" +
            "                                                    <input type=\"text\" class=\"form-control\"  name=\"opt_content\" >\n" +
            "                                                    <div class=\"input-group-text\">\n" +
            "                                                        <a class='button' onclick='test(this)' href=\"#\"><i class=\"la flaticon-cross\"></i></a>\n" +
            "                                                    </div>\n" +
            "                                                </div>";
        container.parentNode.insertBefore(oDiv, node)
        node=oDiv.nextSibling;

    }
    function test(test){
        test.parentNode.parentNode.parentNode.parentNode.removeChild(test.parentNode.parentNode.parentNode);
    }

    function addQuestion(id) {

        //选择题选项数据
        var options = $("input[name='opt_status']");
        var optionData=checkedData(options);
        //判断题选项数据
        var check_options = $("input[name='check_status']");
        var check_optionData=checkedData(check_options);
        //分类数据
        var data=$("#question_choice").serialize();
        //全部数据
        var allData;
        //判断哪种题型
        if(id=='1'){
            //题目数据
            var data1=$('#question_form1').serialize();
             allData=data+"&"+optionData+"&"+data1;
        }else if(id=='2'){
            var data2=$('#question_form2').serialize();
             allData=data+"&"+check_optionData+"&"+data2+"&"+"question_type=判断题";
        }else if(id=='3'){
            var data3=$('#question_form3').serialize();
            allData=data+"&"+data3+"&"+"question_type=主观题&opt_status=1";
        }

        $.get("/question/add.action",allData,function(data){
            if(data.msg =="OK"){
                alert("成功！");
            }else{
                alert("失败！");
                window.location.reload();
            }
        });

    }

    //序列化选项数据
    function checkedData(options) {
        var testData=answerAll(options);
        var oo;
        for (var j=0;j<testData.length;j++){
            if(!oo){
                oo="opt_status"+"="+testData[j].value
            }else{
                oo=oo+"&"+"opt_status"+"="+testData[j].value
            }

        }
        return oo;
       // alert(oo);
    }

    //为选项赋值，0：错误，1：正确
    function answerAll(options) {
        var optList=new Array();
        for (var j=0;j<options.length;j++){
            if(!options[j].checked){
                options[j].value="0";
                optList.push(options[j])
            }else{
                options[j].value="1";
                optList.push(options[j])
            }
        }
        return optList
    }
</script>
</body>
</html>